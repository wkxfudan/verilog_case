UART传输协议
===========

简介
--------------------------------

通用异步收发传输器（Universal Asynchronous Receiver/Transmitter，通常称为UART）是一种异步收发传输器，是电脑硬件的一部分，将数据透过串列通信进行传输。UART通常用在与其他通信接口（如EIA RS-232）的连接上。

## 原理

通用异步接受器-发送器(UART)把数据的字节按照比特顺序发送。另一端的UART把比特组装为字节。每个UART包含一个移位寄存器。通过一根线或其他介质的串行通信比通过多根线的并行通信具有更低成本。

UART通常并不直接产生或接收其他设备的外部信号。独立接口设备用于转换信号的逻辑电平给UART。

通信可以是单工、全双工或半双工。

### 数据帧

![](frame.png)

空闲状态，即没有数据传输，是高电平。这是从（有线）电报时代的历史遗存。线路保持高电平表明线路与传输设备没有损坏。每个字符表示为一个帧，以逻辑低电平为开始比特，然后是数据比特，可选的奇偶校验比特，最后是一个或多个停止比特（逻辑高电平）。大部分应用都是先传最低位的数据比特（the least significant data bit），但也有例外（如IBM 2741打印终端）。

如果线路长期（至少大于传输一帧的时间）保持低电平，这被UART检测为Break condition.

### 接受器

UART硬件受一个内部时钟信号控制。该时钟信号是数据传输率的倍频，典型是比特率的8或16倍。接收器在每个时钟脉冲时测试接收到的信号状态是否为开始比特。如果开始比特的低电平持续传输1个比特所需时间的一半以上，则认为开始了一个数据帧的传输；否则，则认为是毛刺脉冲并忽略。到了下一个比特时间后，线路状态被采样并送入移位寄存器。约定的表示一个字符的所有数据比特(典型为5至8个比特）接收后，移位寄存器可被接收系统使用。UART将设置一个标记指出新数据可用，并产生一个处理器中断请求主机处理器取走接收到的数据。

简化的UART在开始比特下降沿开始重新同步时间，然后在每个数据比特的中心时刻采样。

UART的标准特性之一是在接收下一个字符时在缓冲区保存上一个接收到的字符。这种“双缓冲区”允许接收计算机用一个字符的传输时段来获取缓冲区内的上一个字符。许多UART有更大的FIFO缓冲区，允许主机一次处理多个字符，这特别适用于高传输数据率的串行通信同时处理器中断频率有限（通常中断间隔大于1毫秒）。

### 发送器

UART把一个字符放入移位寄存器，就开始产生一个数据帧。对于全双工通信，发送与接受使用不同的移位寄存器。使用更大的FIFO使得主机处理器或DMA放置多个字节后由UART自主完成传输。　UART用一个标志位表示busy。

### 应用

接收与发送的UART必须达成数据帧协议。如果接收方发现这方面错误，会向主机报告"framing error"标志。

典型的连接modem的串口，使用8个比特表示一个字节，没有奇偶校验位，1个停止位。比特率除以10就是发送ASCII字符的传输速率。

超低成本的嵌入式系统没有UART而是用处理器来实现异步串行通信。

## 参考代码
参见https://github.com/ben-marshall/uart/